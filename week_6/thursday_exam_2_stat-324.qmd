---
title: "Thursday Exam 2 - STAT 324"
format: docx
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(openintro)            ## Data Extraction
library(dplyr)                ## Data Transformation
library(ggplot2)           ## Data Extraction
library(GGally)
library(ggfortify)
library(leaps)
library(caret)
library(boot)                   ## Data Analysis
```

## 1. Overview of the Loan Dataset

The `loan_full_schema` dataset contains information on borrowers and loan characteristics collected by a lending institution. It includes numeric variables such as loan amount, interest rate, annual income, and credit score, allowing us to explore how financial and personal variables impact loan outcomes.

For this analysis, we take a **random sample of 1,000 observations** from the full dataset to make computation more efficient while retaining data variability.

This data is suitable for regression analysis involving transformations, subset selection, and assumption diagnostics. Our primary goal is to predict the **interest rate** based on other loan-related metrics.

## 2. Variable Selection

We will use the following four variables:

* `interest_rate` (response variable)
* `loan_amount`
* `annual_income`
* `number_years_credit_line` which is  2025 - `earliest_credit_line`

```{r subset}
set.seed(324)
data("loans_full_schema")
loan_df <- loans_full_schema %>%
  select(interest_rate, loan_amount, annual_income, earliest_credit_line) %>%
  sample_n(1000) %>% 
  mutate(number_years_credit_line = 2025 - earliest_credit_line) %>% 
  select(-earliest_credit_line)

mod_1_loan_df <- loan_df %>% 
  transmute(log10_loan_amount = log10(loan_amount),
         log10_interest_rate = log10(interest_rate),
         log10_annual_income = log10(annual_income),
         sqrt_number_years_credit_line = sqrt(number_years_credit_line)
         )

head(loan_df)
```

## 3. Viz & Summaries

```{r pairplot, message=FALSE, warning=FALSE}
GGally::ggpairs(loan_df)
```

```{r}
GGally::ggpairs(mod_1_loan_df)
```


## 4. Regular Model — MLR (Multiple Linear Regression)

```{r mlr}
model_mlr <- lm(interest_rate ~ loan_amount + annual_income + number_years_credit_line, data = loan_df)
summary(model_mlr)
```





## 5. Log₁₀ of X — SLR

We choose `loan_amount` as the best predictor for illustration.

```{r slr_logx}
model_logx <- lm(interest_rate ~ log10_loan_amount, data = mod_1_loan_df)
summary(model_logx)
```

## 6. Log₁₀ of X & Log₁₀ of Y — SLR

```{r slr_logx_logy}
model_logxy <- lm(log10_interest_rate ~ log10_loan_amount, data = mod_1_loan_df)
summary(model_logxy)
```


## 7. BIC Best Subset

```{r aic-best}
regfit_full <- regsubsets(interest_rate ~ loan_amount + annual_income + number_years_credit_line, data = loan_df, nvmax = 4)
```


```{r bic-best-2}
plot(x = regfit_full,        ## Specify Model Fit
     scale = "bic"     ## Specify Selection Metric
)
```





## 8. AIC Stepwise

```{r aic-stepwise}
model_mlr <- lm(interest_rate ~ loan_amount + annual_income + number_years_credit_line, data = loan_df)

step_mod <- MASS::stepAIC(model_mlr, direction = "both", trace = TRUE)

```

## 10. Selected Model: BIC Best Subset

Refitting the model based on the lowest BIC subset.

```{r best-bic-model}
model_bic <- lm(interest_rate ~ loan_amount + number_years_credit_line, data = loan_df)  # Example: change based on actual best
summary(model_bic)
```

## 11. Assumption Graphics

```{r assumptions}
autoplot(model_bic) + theme_bw()
```
